

已修补（你现在已经做到）：

✅ start/stop 前 purge_expired（防迟到事件推进过期 hold）

✅ joykey 映射自愈（防脏映射造成异常）

✅ 禁止未知 charger 扩容（防 DoS）

✅ snapshot 排序稳定（压测可对比）

还没做的（不是“漏修”，是“还没进入这个模块”）：

⚠️ 持久化/崩溃恢复（你刚问的这个）

⚠️ 多进程/多机一致性（未来要用外部存储或单点）

⚠️ 更严格的 oracle 状态机约束（比如 CHARGING 必须从 HELD 来、事件幂等等）